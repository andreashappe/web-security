
<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../command-injections/">
      
      
        <link rel="next" href="../ldap-injections/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.8">
    
    
      
        <title>Database-Injections - Web Application Security</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-8KL7RKRNSS"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-8KL7RKRNSS",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-8KL7RKRNSS",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#datenbank-injections" class="md-skip">
          Zum Inhalt
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Kopfzeile">
    <a href="../.." title="Web Application Security" class="md-header__button md-logo" aria-label="Web Application Security" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Web Application Security
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Database-Injections
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Suche" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Suche">
        
        <button type="reset" class="md-search__icon md-icon" title="Zurücksetzen" aria-label="Zurücksetzen" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Suche wird initialisiert
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/andreashappe/web-security" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Web Application Security" class="md-nav__button md-logo" aria-label="Web Application Security" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Web Application Security
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/andreashappe/web-security" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../todo.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Contribute
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Einführung
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Einführung
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/security_principles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grundprinzipien
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/security_as_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sicherheit als Prozess
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integration mit dem Umfeld
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/crypto_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kryptographische Grundlagen
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Web Grundlagen
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Web Grundlagen
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../web-applications/web_technologies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Technologien
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../web-applications/web_applications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web Applikationen
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Zugriffskontrolle
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Zugriffskontrolle
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-and-authorization/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Identifikation und Authentifizierung
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-and-authorization/session_management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session-Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-and-authorization/authorization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autorisierung
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../authentication-and-authorization/sso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Single-Sign On (SSO)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Server-Seitige Angriffe
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Server-Seitige Angriffe
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../allgemein/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Allgemeines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../file-uploads/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File-Uploads
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../path-traversals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Path-Traversals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../command-injections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command-Injections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Database-Injections
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Database-Injections
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    <span class="md-ellipsis">
      SQL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arten-von-sql-injections" class="md-nav__link">
    <span class="md-ellipsis">
      Arten von SQL-Injections
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Arten von SQL-Injections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stacked-queries" class="md-nav__link">
    <span class="md-ellipsis">
      Stacked Queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union-based-sql-injection" class="md-nav__link">
    <span class="md-ellipsis">
      UNION-based SQL-Injection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boolean-based-blind-sql-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Boolean-based Blind SQL Injection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-based-blind-sql-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Time-based Blind SQL Injection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-based-injections" class="md-nav__link">
    <span class="md-ellipsis">
      Error-based Injections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ausbruch-aus-dem-datenbanksystem" class="md-nav__link">
    <span class="md-ellipsis">
      Ausbruch aus dem Datenbanksystem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gegenmanahmen" class="md-nav__link">
    <span class="md-ellipsis">
      Gegenmaßnahmen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#object-relational-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Object-Relational Mapping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nosql-injections" class="md-nav__link">
    <span class="md-ellipsis">
      NoSQL-Injections
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ldap-injections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LDAP-Injections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../type-juggling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Type Juggling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xml-based-attacks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XML-basierte Angriffe
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../serialization-attacks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serialisierungs-Angriffe
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../http-request-smuggling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Request Smuggling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SSTI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSTI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Client-Seitige Angriffe
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Client-Seitige Angriffe
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-side-attacks/allgemeines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Allgemeines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-side-attacks/xss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Javascript-Injections (XSS)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-side-attacks/csrf-attacks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSRF-Angriffe
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-side-attacks/unverified-redirects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redirects und Forwards
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-side-attacks/clickjacking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clickjacking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-side-attacks/reverse-tab-nabbing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reverse Tab-Nabbing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-side-attacks/postMessage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTML5 postMessage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Client-Seitige Härtung
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Client-Seitige Härtung
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-side-hardening/allgemeines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Allgemeines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-side-hardening/integration-externer-komponenten/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integration externer Inhalte
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-side-hardening/referer-policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referer-Policy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client-side-hardening/content-security-policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Content-Security-Policy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Appendix
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/mod_security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apache mod_security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/history/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entstehungsgeschichte
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/weitere-informationen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What to do next?
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sql" class="md-nav__link">
    <span class="md-ellipsis">
      SQL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arten-von-sql-injections" class="md-nav__link">
    <span class="md-ellipsis">
      Arten von SQL-Injections
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Arten von SQL-Injections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stacked-queries" class="md-nav__link">
    <span class="md-ellipsis">
      Stacked Queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union-based-sql-injection" class="md-nav__link">
    <span class="md-ellipsis">
      UNION-based SQL-Injection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boolean-based-blind-sql-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Boolean-based Blind SQL Injection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-based-blind-sql-injection" class="md-nav__link">
    <span class="md-ellipsis">
      Time-based Blind SQL Injection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-based-injections" class="md-nav__link">
    <span class="md-ellipsis">
      Error-based Injections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ausbruch-aus-dem-datenbanksystem" class="md-nav__link">
    <span class="md-ellipsis">
      Ausbruch aus dem Datenbanksystem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gegenmanahmen" class="md-nav__link">
    <span class="md-ellipsis">
      Gegenmaßnahmen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#object-relational-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Object-Relational Mapping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nosql-injections" class="md-nav__link">
    <span class="md-ellipsis">
      NoSQL-Injections
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="datenbank-injections">Datenbank-Injections</h1>
<p>Datenbank-Injections gehören zu den selteneren, dafür aber
schwerwiegenderen, vorkommenden Sicherheitsfehlern. Das Grundproblem
ist, dass Datenbankabfragen unter Zuhilfename von Benutzereingaben
gebaut werden. Durch bösartige Benutzereingaben versuchen Angreifer nun,
das Datenbanksystem zur Freigabe zusätzlicher Daten zu bringen,
unbeabsichtigt Daten zu verändern oder sogar aus dem Datenbanksystem auf
das Betriebssystem auszubrechen.</p>
<h2 id="sql">SQL</h2>
<p>SQL[2] ist die bekannteste Abfragesprache für relationale Datenbanken.
Im Zuge dieser Vorlesung werden nur einfache SQL-Features benötigt. Ein
Beispiel für ein einfaches SQL Statement:</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">column1</span><span class="p">,</span><span class="w"> </span><span class="n">column2</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">table1</span><span class="p">,</span><span class="w"> </span><span class="n">table2</span>
<span class="k">where</span><span class="w"> </span><span class="n">column1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;xyz&#39;</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">column1</span><span class="w"> </span><span class="k">asc</span><span class="o">/</span><span class="k">desc</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<p>In diesem Fall werden zwei Spalten <em>column1</em> und <em>column2</em> aus zwei
Tabellen <em>table1</em> und <em>table2</em> ausgelesen. Mittels der where-Klausel
wird eine Bedingung zur Filterung der Daten hinzugefügt, mittels <em>order
by</em> die Daten entweder aufsteigend oder absteigend sortiert und mittels
<em>limit</em> die Anzahl der Datensätze auf einen Datensatz limitiert.</p>
<p>SQL bietet die Möglichkeit die Ausgaben zweier Queries zu einer
Gesamtausgabe zu kombinieren. Hierfür wird das <em>UNION</em> Kommando
verwendet:</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">column1</span><span class="p">,</span><span class="w"> </span><span class="n">column2</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">table1</span><span class="p">,</span><span class="w"> </span><span class="n">table2</span>
<span class="k">union</span><span class="w"> </span><span class="k">all</span>
<span class="k">select</span><span class="w"> </span><span class="n">column3</span><span class="p">,</span><span class="w"> </span><span class="n">column4</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">table3</span><span class="p">,</span><span class="w"> </span><span class="n">table4</span><span class="p">;</span>
</code></pre></div>
<p>Dies ist nur möglich, wenn beide verwendeten SQL-Queries die idente
Anzahl von Spalten zurück liefern.</p>
<h2 id="arten-von-sql-injections">Arten von SQL-Injections</h2>
<p>Die einfachste Form der SQL-Injection basiert darauf, dass die
Applikation eine String-Concatenation zur Erstellung des SQL-Ausdrucks
verwendet. Der Angreifer versucht einen Wert zu übergeben der, wenn er
in den SQL-String eingesetzt wird, zuerst den bestehenden SQL-Ausdruck
beendet/schließt und danach zusätzlich Code ausführt.</p>
<p>Als Beispiel wird hier ein Login verwendet, der über folgende HTTP
Operation durchgeführt wird:
<a href="https://kino.local/login.php?email=ah@coretec&amp;password=pw">https://kino.local/login.php?email=ah@coretec&amp;password=pw</a>. Der
Angreifer vermutet, dass die Überprüfung des Logins über eine
Datenbank-Abfrage ausgeführt wird, die z.B. in Java als String erstellt
wird:</p>
<div class="highlight"><pre><span></span><code><span class="n">String</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;select * from users where email = &#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="n">email</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;&#39; and password = &#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="n">password</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;&#39; limit 1;&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Die Email-Adresse und das Passwort wird als Teil der Datenbank-Abfrage
verwendet, wird ein Datensatz zurückgegeben wird der erste Datensatz
vermutlich zur Befüllung der Benutzersession verwendet. Wird kein
Datensatz zurückgegeben nimmt die Applikation an, dass der Login nicht
erfolgreich war.</p>
<p>Ein Angreifer würde nun z.B. folgendes Fragment als Passwort übergeben:</p>
<div class="highlight"><pre><span></span><code>1&#39; or &#39;1&#39;=&#39;1
</code></pre></div>
<p>Durch diesen Ausdruck würde folgendes SQL-Kommando entstehen:</p>
<div class="highlight"><pre><span></span><code><span class="n">String</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;select * from users where email = &#39;ah@coretec.at&#39; and password = &#39;1&#39; or &#39;1&#39;=&#39;1&#39; limit 1;&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Anstatt dass die Email-Adresse und das Passwort überprüft werden, wird
nun initial die Email und das Passwort überprüft. Dabei wird
wahrscheinlich als Ergebnis <em>false</em> erzeugt, damit würde prinzipiell
kein Datensatz zurückgegeben werden. Der Angreifer schafft es
allerdings, auch den Ausdruck <em>1=1</em> hinzuzufügen. Dieser ergibt immer
<em>true</em>, durch die Oder-Verknüpfung wird der Gesamtausdruck <em>true</em> und
liefert daher alle Zeilen der Tabelle als Resultat. Der Applikationscode
würde nun die erste Zeile extrahieren und mit diesem Datensatz die
Session befüllen. Der Angreifer hat auf diese Weise das Login-System
überlistet und die Identität eines anderen Benutzers angenommen.</p>
<h3 id="stacked-queries">Stacked Queries</h3>
<p>Die grundsätzliche Methode an eine bestehende SQL-Abfrage zusätzliche
(ungewollte) Queries anzuhängen und dadurch Code auszuführen wird
Stacked Query genannt. Das klassische Beispiel für eine solche ist:</p>
<div class="highlight"><pre><span></span><code>&#39;; drop table users; --
</code></pre></div>
<p>Mittels des ersten Zeichens <code>'</code> wird versucht aus dem vorgesehenen
SQL-Ausdruck auszubrechen. Das Semikolon dient zum Beenden des
eigentlichen Kommandos und der Angreifer kann ein beliebiges
SQL-Kommando anhängen — in diesem Fall ein <em>drop table</em> Kommando,
welches eine Datenbank löschen würde. Zum Schluss wird mit einem
weiteren Semikolon der eingeschleuste Befehlt beendet und durch die
beiden Bindestriche ein Kommentar eingeleitet. Auf diese Weise wird
potentiell nachfolgender SQL-Code auskommentiert.</p>
<h3 id="union-based-sql-injection">UNION-based SQL-Injection</h3>
<p>Bei UNION-basierten SQL-Angriffen wird versucht mittels des <em>UNION</em>
Kommandos ein zusätzliches <em>SELECT</em> Statement an ein bestehendes
Select-Statement anzuhängen. Häufig wird dies verwendet, wenn eine
Web-Applikation eine Tabellen-ähnliche Datenauflistung bietet.</p>
<p>Beispiel: eine Webapplikation stellt eine Liste von Personen als
HTML-Tabelle dar. Ein Benutzer kann diese Liste durch Eingabe einer ID
einschränken. Es wird daher angenommen, dass die Daten der dargestellten
HTML-Tabelle durch eine SQL-Abfrage der Form:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">Phone</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Id</span><span class="o">=</span><span class="err">$</span><span class="n">id</span>
</code></pre></div>
<p>bereitgestellt wird. Der Parameter <em>$id</em> wird durch den Benutzer
bereitgestellt. Ein Angreifer kann nun versuchen, hier eine
SQL-Injection durchzuführen. Beispielsweise könnte dafür folgendes
Fragment verwendet werden:</p>
<div class="highlight"><pre><span></span><code>1 UNION ALL SELECT creditCardNumber,1,1 FROM CreditCardTable
</code></pre></div>
<p>Dieses Fragment wird durch die Webapplikation für <em>$id</em> eingesetzt (da
ID in diesem Fall ein Zahlenwert ist, muss, verglichen mit dem Ausbruch
aus einem String-Wert, werden hier keine Quoting-Zeichen wie ’ benötigt)
und erzeugt auf diese Weise die folgende SQL-Abfrage:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">Phone</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Id</span><span class="o">=</span><span class="mi">1</span>
<span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">creditCardNumber</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">CreditCardTable</span>
</code></pre></div>
<p>Die Tabelle wird nun initial mit den Daten des Users mit der Id 1
befüllt, zusätzlich werden alle Kreditkartennummern der Tabelle
CreditCardTable angehängt (bei diesen Daten werden Spalten 2 und 3 mit
der Konstanten 1 gefüllt).</p>
<p>Da bei einem UNION-Select die Spaltenanzahl der jeweiligen Queries ident
sein muss, muss der Angreifer initial die richtige Spaltenanzahl
erraten. Dies wird zumeist über Brute-Force Angriffe durchgeführt.</p>
<h3 id="boolean-based-blind-sql-injection">Boolean-based Blind SQL Injection</h3>
<p>Eine SQL-Injection ist auch ohne direkten Antwortkanal möglich. Ein
Beispiel hierfür sind Boolean-based blind SQL-Injections.</p>
<p>Ein Beispiel: gegeben eine Produktseite <code>opfer.local/product/1</code>
die ein Produkt anzeigt. Der Angreifer hat bereits erkannt, dass bei
Eingabe von <code>opfer.local/product/1 and 1=1</code> die Produktseite ebenso
angezeigt wird und bei <code>opfer.local/product/1 and 1=0</code> kein Produkt gefunden
wird. Dadurch besteht die Annahme, dass der Angreifer einen Ausdruck and
die Produkt-Id (1) anhängen kann und dass dieser Ausdruck auch
exekutiert wird (der Ausdruck 1=0 ergibt immer <em>false</em>, durch die
Und-Verknüpfung mit <em>false</em> wird kein Produkt mehr geliefert). Dies kann
nun ausgenutzt werden, um mit einzelnen Abfragen den Datenbankinhalt
auszulesen. Beispielsweise kann der Angreifer folgenden Ausdruck bilden:</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">field1</span><span class="p">,</span><span class="w"> </span><span class="n">field2</span><span class="p">,</span><span class="w"> </span><span class="n">field3</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Id</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ASCII</span><span class="p">(</span><span class="k">SUBSTRING</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">=</span><span class="mi">97</span>
</code></pre></div>
<p>An den Suchausdruck wird also eine Substring-Abfrage hinzugefügt. Diese
extrahiert die erste Stelle des Benutzernamens, verwandelt diese über
die <em>ASCII</em>-Funktion in einen ASCII-Wert und überprüft, ob die erste
Stelle des Benutzernamens ein A ist. Wird nun die Produktseite des
Produkts 1 zurückgeliefert, weiß der Angreifer, dass das erste Zeichen
des Benutzernamens ein A ist. Wird keine Produktseite geliefert, würde
der Angreifer versuchen ob der ASCII Wert dem Zeichen B entspricht.
Durch mehrere (tausende) Anfragen kann der Angreifer auf diese Weise die
gesamte Datenbank rekonstruieren.</p>
<h3 id="time-based-blind-sql-injection">Time-based Blind SQL Injection</h3>
<p>Ähnlich wie bei einer boolean based blind SQL-Injection gibt es bei
dieser Angriffsart keinen direkten Antwortkanal für die extrahierten
Informationen. Anstatt wird ein side-channel Angriff auf das
Zeitverhalten der Antwort angewandt.</p>
<p>Der Angreifer besitzt die Möglichkeit ein SQL-Fragment an eine Anfrage
anzuhängen und zur Exekution zu bringen. Wieder wird eine IF-Abfrage
verwendet, in dem konkreten Fall wird, falls die Abfrage erfolgreich
ist, die Antwort um 10 Sekunden verzögert:</p>
<div class="highlight"><pre><span></span><code>http://www.examplecom/product.php?id=10 AND IF(ASCII(SUBSTRING(username,1,1))=97, sleep(10), ‘false’))--
</code></pre></div>
<p>Als Abfrage wird der idente “fängt der Benutzername mit A an?”
verwendet. Falls dies war sein sollte wird mittels <em>sleep(10)</em> die
Antwort verzögert, wenn nicht wird sofort geantwortet. Mittels vieler
Abfragen kann der Angreifer auf diese Weise die gesamte Datenbank
extrahieren.</p>
<p>Im Zuge eines Time-Based Angriffs wird mehr oder weniger ein Model der
Antwortzeiten aufgebaut. Da normalerweise die eingefügte Verzögerung
minimiert wird (um möglichst schnell Daten extrahieren zu können) ist
diese Angriffsart fehlerbehaftet und verwundbar gegenüber
Netzwerk-Jitter. Falls die Netzwerkverbindung selbst instabil ist (also
Anfragen aufgrund des Netzwerks unterschiedlich lange benötigen), können
einzelne Zeichen invalid erkannt werden.</p>
<h3 id="error-based-injections">Error-based Injections</h3>
<p>Bei <em>Error-based Injections</em> wird absichtlich ein Fehler eingebaut um
über den ausgegebenen Fehlertext Informationen zu extrahieren.</p>
<p>Ein Beispiel in MySQL: es gibt in Mysql die mathematische Funktion <em>exp</em>
welche ab einem übergebenen Dezimalwert von ca. 260 einen Fehler
ausgibt. Ebenso gibt es den Operator ‘w̃elcher ein Bitweises Kompliment
bildet. Wird dieser Operator auf das Ergebnis eines Selects angewandt,
ist das Ergebnis eine sehr große Zahl.</p>
<p>Ein Angreifer kann dieses Verhalten für eine Datenextraktion nutzen,
z.B.:</p>
<div class="highlight"><pre><span></span><code>exp(~(select * from (select user()) x)
</code></pre></div>
<p>Es wird also in einem sub-select die Funktion <em>user()</em> aufgerufen, die
den aktuellen Benutzernamen zurück gibt. Auf dieses Ergebnis wird ein
bitweises Kompliment angewandt, es wird eine große Zahl erzeugt; diese
Zahl wird dann an die <em>exp</em>-Funktion übergeben und wird einen Fehler
werfen.</p>
<p>Die generierte Fehlermeldung:</p>
<div class="highlight"><pre><span></span><code>mysql&gt;select exp(~(select * from (select user()) x ));
ERROR 1690(22003): DOUBLE value is out of range in&#39;exp(~((select &#39;root@localhost&#39; from dual)))&#39;
</code></pre></div>
<p>In der Fehlermeldung wurde allerdings der innere SQL-Ausdruck
exekutiert, dadurch wird der Benutzername <em>root@localhost</em> ausgegeben
und eine Datenextraktion ist erfolgt.</p>
<p>Dies ist ein weiterer Grund, warum auf einer Webseite keine
detaillierten Fehlermeldungen ausgegeben werden sollten.</p>
<h2 id="ausbruch-aus-dem-datenbanksystem">Ausbruch aus dem Datenbanksystem</h2>
<p>Eine weitere Möglichkeit des Angreifers ist es aus dem Datenbanksystem
auf das Dateisystem auszubrechen. Dadurch kann er mit den Rechten des
Datenbankbenutzers entweder auf Dateien am Datenbankserver zugreifen
oder besitzt dadurch sogar Shell-Access auf das System. Dies ist einer
der Gründe, warum Datenbanksysteme immer mit einem eigenen Benutzer
laufen sollten.</p>
<p>Ein bekanntes Beispiel für dieses Problem ist die Funktion
<em>xp_cmdshell</em> bei Microsoft SQL-Server welche die Ausführung von
Programmen über SQL erlaubt. Mittlerweile ist diese Funktion aus
Sicherheitsgründen deaktiviert, bei älteren Microsoft SQL-Server
Versionen kann allerdings diese Funktion mittels einer SQL-Injection
ebenso aktiviert werden.</p>
<p>Ein Beispiel aus dem Open-Source Umfeld wäre PostgreSQL, welches es
Datenbankadmins erlaubt, neue Tabellen zu erstellen und diese mit Daten
aus dem Dateisystem zu befüllen:</p>
<div class="highlight"><pre><span></span><code><span class="n">postgres</span><span class="o">-#</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">temp</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">);</span>
<span class="n">postgres</span><span class="o">-#</span><span class="w"> </span><span class="k">COPY</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">;</span>
<span class="n">postgres</span><span class="o">-#</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">offset</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</code></pre></div>
<p>MySQL bietet auch die beiden Zusätze <em>into outfile</em> bzw. <em>into dumpfile</em>
an. Damit wird das Resultat einer SQL-Query in eine Datei gespeichert.
Falls der Datenbankserver mit einer hohen Berechtigunggstufe läuft (z.B.
als <em>root</em> oder <em>www-data</em> Benutzer) kann dies verwendet werden um
Dateien im Filesystem (z.B. im Web-Root) abzulegen und auf diese Weise
eine Webshell hochzuladen (diese würde dann durch den Angreifer über den
Webserver geöffnet werden).</p>
<h2 id="gegenmanahmen">Gegenmaßnahmen</h2>
<p>Da das Grundproblem von SQL-Injections die Erstellung von dynamischen
SQL-Kommandos basierend auf bösartigen Benutzereingaben ist, wäre das
Escapen der Eingabe die erste mögliche Gegenmaßnahme. Dabei werden die
Benutzereingaben so maskiert, dass sie gefahrenlos per
String-Concatenation verwendet werden können. Da diese Lösung
fehleranfällig und Datenbank-spezifisch ist, sollte sie so weit wie
möglich vermieden werden.</p>
<p>Ein besserer Lösungsansatz für SQL-Injection ist die Verwendung von
<em>prepared statements</em>. Bei diesen wird eine SQL-Abfrage mittels einer
API gebaut (und mit Daten befüllt) anstatt “nur” Strings zu verknüpfen.
Aufgrund der zusätzlich bereitgestellten Information ist die
Datenbankbibliothek in der Lage, die benutzer-bereitgestellten Daten in
einer Form einzusetzen, welche SQL-Injections verhindert.</p>
<p>Ein Beispiel in Java:</p>
<div class="highlight"><pre><span></span><code><span class="n">String</span><span class="w"> </span><span class="n">custname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;customerName&quot;</span><span class="p">);</span>
<span class="n">String</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT account_balance FROM user_data WHERE user_name = ?&quot;</span><span class="p">;</span>

<span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pstmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">pstmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">custname</span><span class="p">);</span>

<span class="n">ResultSet</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pstmt</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">();</span>
</code></pre></div>
<p>Die dynamische SQL-Query befindet sich im String <em>query</em> und beinhaltet
einen dynamischen Parameter der mit einem <em>?</em> markiert wird. Durch die
Methode <em>setString</em> wird nun der 1te Parameter auf den Wert der Variable
<em>custname</em> gesetzt und auf diese Weise die Benutzereingabe in einer
sicheren Art und Weise in die SQL-Query eingebaut.</p>
<p>Ein weiteres Beispiel in PHP unter Verwendung von PDOs:</p>
<div class="highlight"><pre><span></span><code><span class="x">$id = 1;</span>
<span class="x">$sth = $DBH-&gt;prepare(&quot;SELECT * FROM juegos WHERE id = :id&quot;);</span>
<span class="x">$sth-&gt;bindParam(&#39;:id&#39;, $id, PDO::PARAM_INT);</span>
<span class="x">$STH-&gt;execute();</span>
</code></pre></div>
<p>Bei diesem Beispiel werden die dynamisch inkludierten Daten mittels
eines Platzhalters (<em>:id</em>) identifiziert und mittels der Methode
<em>bindParam</em> gesetzt. Diese Art der Zuweisung hat den Vorteil, dass <em>:id</em>
innerhalb der Query an mehreren Stellen gesetzt werden kann. Ebenso wird
durch das Hinzufügen eines weiteren dynamischen Parameters die Position
der dynamischen Parameter nicht verändert[3].</p>
<p>Ein Problem mit prepared statements ist, dass nicht alle Elemente einer
SQL-Abfrage auf diese Weise dynamisch befüllt werden können. Häufige
Ausnahmen sind:</p>
<ul>
<li>Tabellennamen</li>
<li>Spaltennamen</li>
<li>die Sortierrichtung (<em>ASC</em>, <em>DESC</em>)</li>
</ul>
<p>Falls diese Felder befüllt werden müssen, wird empfohlen die
Applikationslogik so zu bauen, dass über die Eingabe erkannt wird,
welches Feld gewählt wurde und basierend darauf ein statischer String
zum Bauen der Query verwendet werden. Auf diese Weise wird vermieden,
dass eine Benutzereingabe direkt in den Query-String eingebaut wird.
Ebenso sollte bei einer solchen Konstruktion sowohl eine rigide
Whitelist als auch Escaping verwendet werden.</p>
<p>Ein Vorteil von Prepared Statements ist, dass die Absicherungslogik Teil
der Applikationslogik ist. Andere Methoden (wie z.B. Stored Procedures)
verschieben die Absicherung direkt in den Datenbankserver. Dabei besteht
das Problem, dass z.B. Anwendungsentwickler annehmen könnten, dass
gewisse Datenbank-Funktionen sicher implementiert wurden und
Datenbank-Entwickler annehmen könnten, dass Daten bereits durch die
Applikationsentwickler abgesichert wurden. Hierdurch kann es zu
Diskrepanzen bei der Absicherung kommen.</p>
<p>Eine weitere Gegenmaßnahme sind <em>Stored Procedures</em>. Dies sind
Funktionen die im Datenbanksystem abgelegt und von der Applikation
aufgerufen werden. Eine früher häufig genutzte Sprache zum Erstellen von
Stored Procedures ist PL/SQL, mittlerweile können Stored Procedures auch
in “normalen” Programmiersprachen entwickelt werden. Sie besitzen die
gleichen Probleme wie applikatorische Abfragen: falls eine
String-Verkettung verwendet wird, können SQL-Injections durchgeführt
werden. Stored Procedures sind aber eher auf die Verwendung von
Sprachmustern ausgelegt, die Injection-Angriffe vermeiden (ähnlich wie
Prepared Statements) und da sie meistens von Datenbank-Spezialisten
geschrieben werden, sind sie meistens sicher implementiert. Aus diesem
Grund werden Stored Procedures häufig als Gegenmaßnahme zu
SQL-Injections angeführt, auch wenn dies potentiell vom
implementierenden Programmierer abhängig ist. Ein Nachteil von Stored
Procedures ist, dass der Applikationscode dadurch auf den
Applikationsserver und den Datenbankserver aufgeteilt wird und dadurch
potentiell schwerer wartbar wird.</p>
<h2 id="object-relational-mapping">Object-Relational Mapping</h2>
<p>Object-Relational Mapping (ORM) wird verwendet um basierend auf einer
relationalen Datenbank eine virtuelle Objektdatenbank zu erstellen.
Dabei wird eine ORM-Software verwendet, um aus Datenbank-Zeilen eine
Repräsentation der Daten als Programmiersprachen-Objekt herzustellen.
Datenabfragen und -veränderungsoperationen werden anschließend auf
dieser Objekt-Repräsentation durchgeführt und intern als
Datenbankbefehle ausgeführt.</p>
<p>Ein häufiges Pattern in diesem Umfeld ist das ActiveRecord-Pattern. Bei
diesem entspricht eine Datenbanktabelle einem Objekttypen und eine Zeile
innerhalb der Datenbank wird zu einer Objectinstanz.B.ispielsweise würde
aus der Datenbanktabelle <em>users</em> die Klasse <em>User</em> gebildet werden. Eine
Zeile der Datenbank würde zu einer Objektinstanz und z.B. die Spalte
<em>vorname</em> würde zum Feld <em>vorname</em> des Objekts werden.</p>
<p>Bei den meisten ORMs werden Abfragen innerhalb der
Zielprogrammiersprache abgebildet, hier ein Beispiel in JavaScript unter
Verwendung des ORMs <em>sequalize</em>:</p>
<div class="highlight"><pre><span></span><code><span class="nx">models</span><span class="p">.</span><span class="nx">Items</span><span class="p">.</span><span class="nx">findAll</span><span class="p">({</span>
<span class="w">    </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<p>In dem Beispiel wird ein Objekt des Typs Items erstellt. Problematisch
bei ORMs ist, dass im Hintergrund zumeist SQL-Kommandos erstellt werden
und daher SQL-Injections weiterhin möglich sind, hier ein Beispiel:</p>
<div class="highlight"><pre><span></span><code><span class="nx">models</span><span class="p">.</span><span class="nx">Items</span><span class="p">.</span><span class="nx">findAll</span><span class="p">({</span>
<span class="w">  </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1; DELETE FROM Items WHERE 1=1; --&#39;</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<p>An den Limit-Parameter wird eine Stacked-Query angehängt und auf diese
Weise eine SQL-Injection ausgeführt. Anhand diese Beispiels kann erkannt
werden, das ORMs kein Allheilmittel für SQL-Injections sind.</p>
<h2 id="nosql-injections">NoSQL-Injections</h2>
<p>In den letzten Jahren werden vermehrt NoSQL-Datenbanken eingesetzt.
Diese verwenden nicht SQL als Abfragesprache, sondern meistens
eigenständige Abfragesprachen oder exekutieren JavaScript-Snippets als
Query. Hier ein Beispiel in MongoDB:</p>
<div class="highlight"><pre><span></span><code><span class="nx">db</span><span class="p">.</span><span class="nx">myCollection</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">active</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">$where</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">credits</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">debits</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">$userInput</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>Bei diesem Beispiel wird als Query der aktuellen Kontostand berechnet
(<em>credits - debits</em>), falls dieser unter einer benutzerdefinierten
Schranke liegt (<em>$userInput</em>) wird der behalten, ansonsten ausgefiltert.
Die Abfrage ist als JavaScript implementiert und nicht als SQL.</p>
<p>Die grundsätzliche Problematik einer Injection bleibt ident. In dem
gewählten Beispiel wird z.B. die Benutzereingabe nicht escaped, ein
Angreifer kann daher auf diese Weise Schadcode einfügen:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="s2">&quot;(function(){var date = new Date(); do{curDate = new Date();}while(curDate-date&lt;10000); return Math.max();})()&quot;</span>
</code></pre></div>
<p>Hier wird nun innerhalb der Abfrage eine Javascript-Funktion definiert
und sofort danach aufgerufen. Die Funktion macht nichts anderes, als 10
Sekunden lang eine Endlosschleife aufzurufen. Falls der MongoDB-Server
nach dem Absetzen dieser Query für 10 Sekunden nicht antwortet und eine
CPU zu 100% ausgelastet ist, hat man also eine datenbankseitige
Injection erreicht.</p>
<p>Wie man an dem Beispiel sehen kann, ist der alleinige Einsatz von
NoSQL-Datenbanken nicht ausreichend um eine Datenbank-Injection zu
vermeiden.</p>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Zurück zum Seitenanfang
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/andreashappe/web-security" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.tracking", "navigation.path", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "In Zwischenablage kopiert", "clipboard.copy": "In Zwischenablage kopieren", "search.result.more.one": "1 weiteres Suchergebnis auf dieser Seite", "search.result.more.other": "# weitere Suchergebnisse auf dieser Seite", "search.result.none": "Keine Suchergebnisse", "search.result.one": "1 Suchergebnis", "search.result.other": "# Suchergebnisse", "search.result.placeholder": "Suchbegriff eingeben", "search.result.term.missing": "Es fehlt", "select.version": "Version ausw\u00e4hlen"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>